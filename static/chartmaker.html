<!doctype html>
<html>
<head>

  <script src="https://www.gstatic.com/firebasejs/4.5.1/firebase.js"></script>
  <script>
    // Initialize Firebase
    var config = {
      apiKey: "AIzaSyCJHF3U8lV2EVABu9KUnk2_5cARkps6Iv4",
      authDomain: "buzzed-a95f9.firebaseapp.com",
      databaseURL: "https://buzzed-a95f9.firebaseio.com",
      projectId: "buzzed-a95f9",
      storageBucket: "",
      messagingSenderId: "888857455202"
    };
    firebase.initializeApp(config);
  </script>
    <title>Scatter Chart</title>
    <script src="http://www.chartjs.org/dist/2.7.0/Chart.bundle.js"></script>
    <script src="http://www.chartjs.org/samples/latest/utils.js"></script>
    <style>
    canvas {
        -moz-user-select: none;
        -webkit-user-select: none;
        -ms-user-select: none;
    }
    </style>
</head>

<body>
    <div style="width:75%">
        <canvas id="canvas"></canvas>
    </div>
    <button id="randomizeData">Randomize Data</button>
    <script>
        var color = Chart.helpers.color;
        var scatterChartData = {
          /*options: {scales: {
              xAxes: [{
                 ticks: {
                  fontSize: 10
                 }
                }]
              }
           }*/
            datasets: [{
                label: "Responses",
                borderColor: window.chartColors.blue,
                backgroundColor: color(window.chartColors.blue).alpha(0.2).rgbString(),
                data: [{

                }]
  }
          ]
        };
        window.onload = function() {
            var ctx = document.getElementById("canvas").getContext("2d");
            var myScatter = Chart.Scatter(ctx, {
                data: scatterChartData,
                options: {
                    title: {
                        display: true,
                        text: 'Buzzinga',
                        fontSize: 20
                    },
                    scales: {
                      xAxes: [{
                        scaleLabel: {
                          display: true,
                          labelString: "Social",
                          fontSize: 20
                        },
                        ticks: {
                          beginAtZero: true,
                          steps: 10,
                          stepValue: 5,
                          max: 100,
                          fontSize: 20
                        }
                      }],
                      yAxes: [{
                        scaleLabel: {
                          display: true,
                          labelString: "Academic",
                          fontSize: 20
                        },
                      ticks: {
                        beginAtZero: true,
                        steps: 10,
                        stepValue: 5,
                        max: 100,
                            fontSize: 20
                        }
                      }]
                    }
                  }
                });
                window.myScatter = myScatter;
              };

        /*document.getElementById('randomizeData').addacademicstListener('click', function() {
            scatterChartData.datasets.forEach(function(dataset) {
                dataset.data = dataset.data.map(function() {
                    return {
                        //x: randomScalingFactor(),
                        //y: randomScalingFactor()
                    };new
                });
            });
            window.myScatter.update();
        });*/
        function toInteger(number){
            return Math.round( // round to nearest integer
            Number(number) // type cast your input
          );
        };
        var userScoresRef = firebase.database().ref('user-scores');
        userScoresRef.orderByChild("timestamp").limitToLast(5).on('child_added', function(data) {
          console.log("fired");
          var totalSocial = data.val()["total-social"];
          var totalAcademic = data.val()["total-academic"];

          var social = data.val().social;
          var academic = data.val().academic;

          console.log(social);

          myScatter.data.datasets[0].data.push(
            {
              x: toInteger((social/totalSocial)*100),
              y: toInteger((academic/totalAcademic)*100),
            }
          );
          myScatter.update();

        });
    </script>
</body>

</html>
